<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æ£€æŸ¥ - Live Dealer Admin V2.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-6">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                è‚¡ä¸œ/ä»£ç†åˆ†äº«åŠŸèƒ½æ£€æŸ¥
            </h1>

            <div class="space-y-4">
                <!-- ç³»ç»Ÿä¿¡æ¯ -->
                <div class="border rounded-lg p-4">
                    <h2 class="font-bold text-lg mb-3">ğŸ“‹ ç³»ç»Ÿä¿¡æ¯</h2>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="bg-gray-50 p-2 rounded">
                            <span class="text-gray-600">ç³»ç»Ÿç‰ˆæœ¬:</span>
                            <span class="font-bold ml-2">Live Dealer Admin V2.1</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded">
                            <span class="text-gray-600">å½“å‰æ—¶é—´:</span>
                            <span class="font-bold ml-2" id="currentTime"></span>
                        </div>
                    </div>
                </div>

                <!-- JavaScriptåŠŸèƒ½æ£€æŸ¥ -->
                <div class="border rounded-lg p-4">
                    <h2 class="font-bold text-lg mb-3">ğŸ”§ JavaScriptåŠŸèƒ½æ£€æŸ¥</h2>
                    <div id="jsChecks" class="space-y-2"></div>
                </div>

                <!-- APIç«¯ç‚¹æ£€æŸ¥ -->
                <div class="border rounded-lg p-4">
                    <h2 class="font-bold text-lg mb-3">ğŸŒ APIç«¯ç‚¹æ£€æŸ¥</h2>
                    <div id="apiChecks" class="space-y-2"></div>
                </div>

                <!-- æ–‡ä»¶åŠ è½½æ£€æŸ¥ -->
                <div class="border rounded-lg p-4">
                    <h2 class="font-bold text-lg mb-3">ğŸ“¦ æ–‡ä»¶åŠ è½½æ£€æŸ¥</h2>
                    <div id="fileChecks" class="space-y-2"></div>
                </div>

                <!-- æ“ä½œè¯´æ˜ -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h2 class="font-bold text-blue-800 mb-2">ğŸ’¡ å¦‚ä½•è§£å†³é—®é¢˜</h2>
                    <div class="text-sm text-blue-700 space-y-1">
                        <p><strong>å¦‚æœçœ‹åˆ°çº¢è‰²âŒï¼š</strong></p>
                        <p>1. æŒ‰ <kbd class="bg-white px-2 py-1 rounded border">Ctrl + Shift + R</kbd> (Windows) æˆ– <kbd class="bg-white px-2 py-1 rounded border">Cmd + Shift + R</kbd> (Mac) å¼ºåˆ¶åˆ·æ–°</p>
                        <p>2. æˆ–æŒ‰ <kbd class="bg-white px-2 py-1 rounded border">F12</kbd> æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Networkæ ‡ç­¾ â†’ å‹¾é€‰"Disable cache" â†’ åˆ·æ–°é¡µé¢</p>
                        <p>3. æˆ–ä½¿ç”¨æµè§ˆå™¨çš„éšç§/æ— ç—•æ¨¡å¼è®¿é—®</p>
                    </div>
                </div>

                <!-- è®¿é—®æŒ‰é’® -->
                <div class="flex gap-3">
                    <a href="/" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-lg text-center font-bold hover:bg-blue-600 transition">
                        <i class="fas fa-home mr-2"></i>è¿”å›é¦–é¡µ
                    </a>
                    <button onclick="runChecks()" class="flex-1 bg-green-500 text-white py-3 px-4 rounded-lg font-bold hover:bg-green-600 transition">
                        <i class="fas fa-sync-alt mr-2"></i>é‡æ–°æ£€æŸ¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰æ—¶é—´
        document.getElementById('currentTime').textContent = new Date().toLocaleString('zh-CN');

        function addCheckResult(containerId, name, passed, details = '') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `flex items-start gap-2 p-2 rounded ${passed ? 'bg-green-50' : 'bg-red-50'}`;
            div.innerHTML = `
                <i class="fas fa-${passed ? 'check-circle text-green-500' : 'times-circle text-red-500'} mt-0.5"></i>
                <div class="flex-1">
                    <div class="font-medium ${passed ? 'text-green-800' : 'text-red-800'}">${name}</div>
                    ${details ? `<div class="text-xs text-gray-600 mt-1">${details}</div>` : ''}
                </div>
            `;
            container.appendChild(div);
        }

        async function runChecks() {
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            document.getElementById('jsChecks').innerHTML = '';
            document.getElementById('apiChecks').innerHTML = '';
            document.getElementById('fileChecks').innerHTML = '';

            // 1. JavaScriptåŠŸèƒ½æ£€æŸ¥
            console.log('=== JavaScriptåŠŸèƒ½æ£€æŸ¥ ===');
            
            const jsFunctions = [
                'showAgentShareSettings',
                'saveAgentShareSettings',
                'regenerateInviteCode',
                'verifyAgentDomain',
                'copyInviteCode',
                'copyAgentInviteCode',
                'copyAgentInviteUrl'
            ];

            jsFunctions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                console.log(`${funcName}:`, exists ? 'âœ…' : 'âŒ');
                addCheckResult('jsChecks', funcName, exists, 
                    exists ? 'å‡½æ•°å·²åŠ è½½' : 'å‡½æ•°æœªæ‰¾åˆ°ï¼Œè¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜');
            });

            // 2. APIç«¯ç‚¹æ£€æŸ¥
            console.log('=== APIç«¯ç‚¹æ£€æŸ¥ ===');
            
            // æµ‹è¯•å…¬å¼€APIï¼ˆæ— éœ€è®¤è¯ï¼‰
            try {
                const response = await fetch('/api/v1/public/agent-by-invite/TEST1234');
                const data = await response.json();
                const passed = response.status === 404 && data.message.includes('é‚€è¯·ç ');
                console.log('å…¬å¼€APIæµ‹è¯•:', passed ? 'âœ…' : 'âŒ', data);
                addCheckResult('apiChecks', 'é‚€è¯·ç éªŒè¯API', passed, 
                    `çŠ¶æ€: ${response.status}, å“åº”: ${data.message}`);
            } catch (error) {
                console.error('APIæµ‹è¯•å¤±è´¥:', error);
                addCheckResult('apiChecks', 'é‚€è¯·ç éªŒè¯API', false, `é”™è¯¯: ${error.message}`);
            }

            // 3. æ–‡ä»¶åŠ è½½æ£€æŸ¥
            console.log('=== æ–‡ä»¶åŠ è½½æ£€æŸ¥ ===');
            
            try {
                const appJsResponse = await fetch('/static/app.js', { method: 'HEAD' });
                const passed = appJsResponse.ok;
                const contentLength = appJsResponse.headers.get('content-length');
                console.log('app.jsåŠ è½½:', passed ? 'âœ…' : 'âŒ', `å¤§å°: ${contentLength} å­—èŠ‚`);
                addCheckResult('fileChecks', 'app.jsæ–‡ä»¶', passed, 
                    `HTTPçŠ¶æ€: ${appJsResponse.status}, å¤§å°: ${(contentLength / 1024).toFixed(2)} KB`);
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦æ­£ç¡®ï¼ˆåº”è¯¥çº¦522KBï¼‰
                const expectedSize = 500 * 1024; // è‡³å°‘500KB
                const sizeCheck = parseInt(contentLength) > expectedSize;
                addCheckResult('fileChecks', 'app.jsæ–‡ä»¶å¤§å°', sizeCheck,
                    sizeCheck ? 'æ–‡ä»¶å¤§å°æ­£å¸¸' : 'æ–‡ä»¶å¯èƒ½è¢«ç¼“å­˜ï¼Œè¯·å¼ºåˆ¶åˆ·æ–°');
            } catch (error) {
                console.error('æ–‡ä»¶æ£€æŸ¥å¤±è´¥:', error);
                addCheckResult('fileChecks', 'app.jsæ–‡ä»¶', false, `é”™è¯¯: ${error.message}`);
            }

            // 4. æ•´ä½“æ£€æŸ¥ç»“æœ
            const allPassed = jsFunctions.every(func => typeof window[func] === 'function');
            
            if (allPassed) {
                console.log('âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼');
                showNotification('success', 'âœ… æ‰€æœ‰åŠŸèƒ½æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥æ­£å¸¸ä½¿ç”¨è‚¡ä¸œ/ä»£ç†åˆ†äº«åŠŸèƒ½ã€‚');
            } else {
                console.log('âŒ éƒ¨åˆ†åŠŸèƒ½ç¼ºå¤±ï¼Œè¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜');
                showNotification('error', 'âŒ æ£€æµ‹åˆ°åŠŸèƒ½ç¼ºå¤±ï¼Œè¯·æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼');
            }
        }

        function showNotification(type, message) {
            const div = document.createElement('div');
            div.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white font-bold z-50`;
            div.textContent = message;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 5000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæ£€æŸ¥
        window.addEventListener('load', runChecks);
    </script>
</body>
</html>
