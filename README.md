# çœŸäººè·å®˜è§†è®¯åå°ç®¡ç†ç³»ç»Ÿ V2.1

## é¡¹ç›®æ¦‚è§ˆ
- **åç§°**: Live Dealer Admin System (çœŸäººè·å®˜è§†è®¯åå°ç®¡ç†ç³»ç»Ÿ)
- **ç‰ˆæœ¬**: V2.1
- **ç›®æ ‡**: ä¸ºçœŸäººè·å®˜è§†è®¯å¹³å°æä¾›å…¨æ–¹ä½çš„ä¸­å¤®åå°æ§åˆ¶æ¢çº½
- **æŠ€æœ¯æ ˆ**: Hono + TypeScript + TailwindCSS + Cloudflare D1 + Chart.js

## åœ¨çº¿é¢„è§ˆ
- **å¼€å‘ç¯å¢ƒ**: https://3000-i9mzigr2smruxfa8tgrk9-2e77fc33.sandbox.novita.ai
- **ç™»å½•è´¦å·**: admin / 123456
- **éªŒè¯ç **: è¾“å…¥é¡µé¢æ˜¾ç¤ºçš„4ä½éªŒè¯ç 

## ğŸ”’ å®‰å…¨ç‰¹æ€§ (V2.1.1)

### è®¤è¯ä¸æˆæƒ
- **JWT Tokenè®¤è¯**: ä½¿ç”¨HMAC-SHA256ç­¾åçš„å®‰å…¨ä»¤ç‰Œ
- **Tokenæœ‰æ•ˆæœŸ**: 8å°æ—¶è‡ªåŠ¨è¿‡æœŸ
- **APIä¸­é—´ä»¶ä¿æŠ¤**: æ‰€æœ‰æ•æ„ŸAPIå¼ºåˆ¶è®¤è¯
- **RBACæƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### å¯†ç å®‰å…¨
- **SHA-256å“ˆå¸Œ**: å¯†ç ä½¿ç”¨åŠ å¯†å“ˆå¸Œå­˜å‚¨
- **äºŒæ¬¡å¯†ç éªŒè¯**: æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡å¯†ç ç¡®è®¤
- **æ—¶åºå®‰å…¨æ¯”è¾ƒ**: é˜²æ­¢æ—¶åºæ”»å‡»

### è¾“å…¥éªŒè¯
- **å‚æ•°æ ¡éªŒ**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯
- **åˆ†é¡µé™åˆ¶**: é˜²æ­¢è¶…å¤§åˆ†é¡µå¯¼è‡´çš„æ€§èƒ½é—®é¢˜
- **IDéªŒè¯**: æ•°å­—IDèŒƒå›´æ£€æŸ¥
- **SQLæ³¨å…¥é˜²æŠ¤**: LIKEæŸ¥è¯¢å‚æ•°è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

### å‰ç«¯å®‰å…¨
- **XSSé˜²æŠ¤**: ç”¨æˆ·è¾“å…¥HTMLè½¬ä¹‰
- **å±æ€§è½¬ä¹‰**: åŠ¨æ€å±æ€§å®‰å…¨å¤„ç†
- **ç±»å‹å¼ºåˆ¶**: æ•°å­—å‚æ•°ç±»å‹è½¬æ¢

### å®¡è®¡è¿½è¸ª
- **å®Œæ•´å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ
- **çœŸå®æ“ä½œå‘˜ä¿¡æ¯**: æ—¥å¿—åŒ…å«å®é™…æ‰§è¡Œè€…
- **IPåœ°å€è®°å½•**: è¿½è¸ªæ“ä½œæ¥æº

### CORSå®‰å…¨
- **åŸŸåç™½åå•**: é™åˆ¶è·¨åŸŸè¯·æ±‚æ¥æº
- **å‡­è¯æ§åˆ¶**: ä¸¥æ ¼çš„credentialsç­–ç•¥

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (11å¤§æ¨¡å—)

### 1.0 ä»ªè¡¨ç›˜ (Dashboard)
- KPIæ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ (æ€»è¥æ”¶ã€æ€»ç©å®¶ã€ä»Šæ—¥å­˜æ¬¾ã€ä»Šæ—¥æŠ•æ³¨)
- å…¬å¸èµ„é‡‘æ± çŠ¶æ€å®æ—¶ç›‘æ§
- 7å¤©æ¸¸æˆè¥æ”¶è¶‹åŠ¿å›¾è¡¨
- 7å¤©æ´»è·ƒç©å®¶è¶‹åŠ¿å›¾è¡¨
- å¿«æ·æ“ä½œå…¥å£

### 2.0 ç©å®¶æ§ç«¯ (Player Management)
- ç©å®¶åˆ—è¡¨æŸ¥è¯¢ä¸ç­›é€‰
- ç©å®¶åœ¨çº¿ç›‘æ§
- ç©å®¶çŠ¶æ€ç®¡ç† (å†»ç»“/è§£å†»)
- ç©å®¶è¯¦æƒ…ä¸æµæ°´æŸ¥è¯¢
- ç©å®¶LTVç»Ÿè®¡åˆ†æ

### 3.0 å±‚çº§æ§ç«¯ (Agent & Hierarchy)
- ä»£ç†åˆ—è¡¨ç®¡ç†
- å¤šçº§ä»£ç†æ ‘å½¢ç»“æ„å±•ç¤º (è‚¡ä¸œ > æ€»ä»£ > ä»£ç†)
- ä½£é‡‘æ¨¡å‹é…ç½®
- å æˆæ¯”ä¾‹è®¾ç½®

### 4.0 è´¢åŠ¡æ§ç«¯ (Finance & Accounting)
- è´¦æˆ·æ˜ç»†å…¨æµæ°´æŸ¥è¯¢
- å­˜æ¬¾ç”³è¯·å®¡æ ¸
- å–æ¬¾ç”³è¯·å®¡æ ¸ (å«æµæ°´æ£€æµ‹)
- äººå·¥è°ƒè´¦åŠŸèƒ½

### 5.0 æ³¨å•æ§ç«¯ (Betting Records)
- æ³¨å•åˆ—è¡¨æŸ¥è¯¢
- å¤šæ¸¸æˆç±»å‹ç­›é€‰ (ç™¾å®¶ä¹/é¾™è™/è½®ç›˜/éª°å®/ç‰›ç‰›)
- æ³¨å•è¯¦æƒ…ä¸å›æ”¾

### 6.0 çº¢åˆ©ä¸æ´—ç  (Bonus & Commission) â­V2.1å‡çº§
- æ´—ç æ–¹æ¡ˆé…ç½® (å¤šå¥—æ–¹æ¡ˆæ¨¡æ¿)
- å·®å¼‚åŒ–æ¸¸æˆè¿”æ°´æ¯”ä¾‹
- æ´—ç è®°å½•å®¡æ ¸
- è‡ªåŠ¨/äººå·¥å‘æ”¾

### 7.0 é£é™©æ§ç«¯ (Risk Management)
- å®æ—¶é£æ§é¢„è­¦ç›‘æ§
- é£é™©ç­‰çº§åˆ†ç±» (é«˜/ä¸­/ä½)
- å¥—åˆ©ç›‘æ§ä¸å¤„ç†
- é™çº¢ç»„é…ç½®

### 8.0 æŠ¥è¡¨ä¸­å¿ƒ (Reports Center)
- æ¯æ—¥ç»“ç®—æŠ¥è¡¨
- ç›ˆäºæ’è¡Œæ¦œ (ç›ˆåˆ©æ¦œ/äºæŸæ¦œ TOP 50)
- å¤šç»´åº¦æ•°æ®å¯¼å‡º

### 9.0 å†…å®¹æ§ç«¯ (CMS)
- å…¬å‘Šç®¡ç† (è·‘é©¬ç¯/å¼¹çª—/è½®æ’­å›¾)
- å¤šè¯­è¨€æ”¯æŒ
- å®šæ—¶å‘å¸ƒåŠŸèƒ½

### 10.0 ç³»ç»Ÿæ§ç«¯ (System Settings)
- ç®¡ç†å‘˜è´¦å·ç®¡ç†
- RBACè§’è‰²æƒé™
- 2FAåŒå› ç´ è®¤è¯
- æ“ä½œæ—¥å¿—å®¡è®¡

### 11.0 ç°åœºè¿è¥æ§ç«¯ (Studio Management) â­V2.1æ–°å¢
- è·å®˜æ¡£æ¡ˆåº“ç®¡ç†
- æ¡Œå°é…ç½®ç®¡ç†
- æ™ºèƒ½æ’ç­ç³»ç»Ÿ (ç”˜ç‰¹å›¾å¯è§†åŒ–)

## æ•°æ®æ¶æ„

### æ ¸å¿ƒæ•°æ®è¡¨
| è¡¨å | è¯´æ˜ |
|------|------|
| admin_users | ç®¡ç†å‘˜è´¦å· |
| admin_roles | è§’è‰²æƒé™ |
| agents | ä»£ç†å±‚çº§ |
| users | ç©å®¶ç”¨æˆ· |
| transactions | äº¤æ˜“æµæ°´ |
| bets | æ³¨å•è®°å½• |
| commission_schemes | æ´—ç æ–¹æ¡ˆ |
| commission_records | æ´—ç è®°å½• |
| risk_rules | é£æ§è§„åˆ™ |
| risk_alerts | é£æ§é¢„è­¦ |
| dealers | è·å®˜æ¡£æ¡ˆ |
| game_tables | æ¡Œå°é…ç½® |
| dealer_shifts | æ’ç­è®°å½• |
| announcements | å…¬å‘Šå†…å®¹ |
| audit_logs | æ“ä½œæ—¥å¿— |

### å­˜å‚¨æœåŠ¡
- **Cloudflare D1**: SQLiteå…³ç³»å‹æ•°æ®åº“ï¼Œç”¨äºæ‰€æœ‰ä¸šåŠ¡æ•°æ®å­˜å‚¨

## APIæ¥å£è§„èŒƒ

### è®¤è¯æ¨¡å—
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/auth/login | POST | ç®¡ç†å‘˜ç™»å½• |
| /api/v1/auth/me | GET | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |

### ä»ªè¡¨ç›˜
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/dashboard/stats | GET | è·å–æ ¸å¿ƒç»Ÿè®¡æ•°æ® |
| /api/v1/dashboard/trends | GET | è·å–7å¤©è¶‹åŠ¿æ•°æ® |

### ç©å®¶ç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/players | GET | ç©å®¶åˆ—è¡¨ |
| /api/v1/players/:id | GET | ç©å®¶è¯¦æƒ… |
| /api/v1/players/:id/status | PUT | æ›´æ–°ç©å®¶çŠ¶æ€ |
| /api/v1/players/online | GET | åœ¨çº¿ç©å®¶ |

### ä»£ç†ç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/agents | GET | ä»£ç†åˆ—è¡¨ |
| /api/v1/agents/tree | GET | ä»£ç†æ ‘å½¢ç»“æ„ |

### è´¢åŠ¡ç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/finance/transactions | GET | äº¤æ˜“æµæ°´ |
| /api/v1/finance/deposits | GET | å¾…å®¡æ ¸å­˜æ¬¾ |
| /api/v1/finance/withdrawals | GET | å¾…å®¡æ ¸ææ¬¾ |
| /api/v1/finance/transactions/:id/audit | POST | å®¡æ ¸äº¤æ˜“ |

### æ³¨å•ç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/bets | GET | æ³¨å•åˆ—è¡¨ |

### æ´—ç ç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/commission/schemes | GET | æ´—ç æ–¹æ¡ˆåˆ—è¡¨ |
| /api/v1/commission/records | GET | æ´—ç è®°å½•åˆ—è¡¨ |

### é£æ§ç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/risk/alerts | GET | é£æ§é¢„è­¦åˆ—è¡¨ |

### æŠ¥è¡¨ä¸­å¿ƒ
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/reports/settlement | GET | ç»“ç®—æŠ¥è¡¨ |
| /api/v1/reports/ranking | GET | ç›ˆäºæ’è¡Œæ¦œ |

### ç°åœºè¿è¥
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/dealers | GET | è·å®˜åˆ—è¡¨ |
| /api/v1/tables | GET | æ¡Œå°åˆ—è¡¨ |
| /api/v1/shifts | GET | æ’ç­æ•°æ® |

### ç³»ç»Ÿç®¡ç†
| è·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/v1/admin/users | GET | ç®¡ç†å‘˜åˆ—è¡¨ |
| /api/v1/admin/roles | GET | è§’è‰²åˆ—è¡¨ |
| /api/v1/admin/audit-logs | GET | æ“ä½œæ—¥å¿— |
| /api/v1/announcements | GET | å…¬å‘Šåˆ—è¡¨ |

## ç”¨æˆ·æŒ‡å—

### ç™»å½•ç³»ç»Ÿ
1. è®¿é—®ç³»ç»Ÿç™»å½•é¡µé¢
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
3. è¾“å…¥é¡µé¢æ˜¾ç¤ºçš„å›¾å½¢éªŒè¯ç 
4. ç‚¹å‡»"ç™»å½•"æŒ‰é’®

### å¯¼èˆªè¯´æ˜
- å·¦ä¾§è¾¹æ ä¸ºä¸»å¯¼èˆªèœå•ï¼Œç‚¹å‡»å±•å¼€å­èœå•
- é¡¶æ æ˜¾ç¤ºå½“å‰ä½ç½®å’Œå¿«æ·æ“ä½œæŒ‰é’®
- å³ä¸Šè§’æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯å’Œé€€å‡ºæŒ‰é’®

### æƒé™è¯´æ˜
ç³»ç»Ÿé‡‡ç”¨RBACè§’è‰²æƒé™æ§åˆ¶ï¼š
- **è¶…çº§ç®¡ç†å‘˜**: æ‹¥æœ‰æ‰€æœ‰æƒé™
- **è´¢åŠ¡æ€»ç›‘**: è´¢åŠ¡å®¡æ ¸ä¸æŠ¥è¡¨
- **é£æ§ä¸“å‘˜**: é£é™©ç›‘æ§ä¸å¤„ç†
- **å®¢æœä¸»ç®¡**: ç©å®¶æœåŠ¡
- **è¿è¥äººå‘˜**: å†…å®¹ä¸å…¬å‘Šç®¡ç†
- **ç°åœºä¸»ç®¡**: è·å®˜ä¸æ’ç­ç®¡ç†

## éƒ¨ç½²é…ç½®

### å¼€å‘ç¯å¢ƒ
```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# åˆå§‹åŒ–æ•°æ®åº“
npm run db:migrate:local
npm run db:seed

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pm2 start ecosystem.config.cjs
```

### ç”Ÿäº§éƒ¨ç½² (Cloudflare Pages)
```bash
# æ„å»ºå¹¶éƒ¨ç½²
npm run deploy

# åˆ›å»ºç”Ÿäº§æ•°æ®åº“
npx wrangler d1 create live-dealer-db

# åº”ç”¨è¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run db:migrate:prod
```

## é¡¹ç›®ç»“æ„
```
webapp/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.tsx          # Honoä¸»åº”ç”¨ (API + é¡µé¢è·¯ç”±)
â”œâ”€â”€ public/
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ app.js         # å‰ç«¯JavaScripté€»è¾‘
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 0001_initial_schema.sql  # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ seed.sql               # åˆå§‹åŒ–æµ‹è¯•æ•°æ®
â”œâ”€â”€ ecosystem.config.cjs   # PM2é…ç½®
â”œâ”€â”€ wrangler.jsonc         # Cloudflareé…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### V2.1 (å½“å‰ç‰ˆæœ¬)
- â­ æ–°å¢: ç°åœºè¿è¥æ§ç«¯ (è·å®˜æ¡£æ¡ˆã€æ¡Œå°ç®¡ç†ã€æ™ºèƒ½æ’ç­)
- â­ å‡çº§: æ´—ç ç³»ç»Ÿä»"è®¡ç®—"å‡çº§ä¸º"ç­–ç•¥é…ç½®"
- ä¼˜åŒ–: æ”¯æŒå¤šå¥—æ´—ç æ–¹æ¡ˆæ¨¡æ¿
- ä¼˜åŒ–: å·®å¼‚åŒ–æ¸¸æˆè¿”æ°´æ¯”ä¾‹é…ç½®
- ä¼˜åŒ–: è‡ªåŠ¨/äººå·¥å®¡æ ¸åˆ†æµæœºåˆ¶

### V2.0 (åŸºç¡€ç‰ˆæœ¬)
- 10å¤§æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
- ç©å®¶/ä»£ç†/è´¢åŠ¡/æ³¨å•ç®¡ç†
- é£æ§é¢„è­¦ç³»ç»Ÿ
- æŠ¥è¡¨ä¸­å¿ƒ

## æŠ€æœ¯æ”¯æŒ

æœ¬ç³»ç»ŸåŸºäºä»¥ä¸‹æŠ€æœ¯æ„å»ºï¼š
- **åç«¯æ¡†æ¶**: Hono (è½»é‡çº§é«˜æ€§èƒ½)
- **æ•°æ®åº“**: Cloudflare D1 (è¾¹ç¼˜SQLite)
- **å‰ç«¯æ ·å¼**: TailwindCSS
- **å›¾è¡¨åº“**: Chart.js
- **å›¾æ ‡åº“**: Font Awesome 6
- **è¿è¡Œç¯å¢ƒ**: Cloudflare Workers (è¾¹ç¼˜è®¡ç®—)

---
**ç‰ˆæœ¬**: V2.1  
**æ›´æ–°æ—¥æœŸ**: 2025-11-29  
**å¼€å‘å›¢é˜Ÿ**: è¿è¥ä¸äº§å“è”åˆå›¢é˜Ÿ
